<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MBK Chat</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
  body { background:black; color:#3CA832; font-family:Arial; padding:20px; }
  #messages { height:70vh; overflow-y:auto; border:1px solid #3CA832; padding:10px; }
  input, button { margin-top:10px; padding:8px; background:#111; color:#3CA832; border:1px solid #3CA832; }
</style>
</head>
<body>
<h2>ðŸ’¬ MBK Chat Room</h2>
<div id="messages"></div>
<input id="msgInput" placeholder="Type your message..." />
<button onclick="sendMessage()">Send</button>

<script>
  const { createClient } = supabase;
  const supabaseUrl = 'https://xfgbsioinhnfyrhtpcdr.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhmZ2JzaW9pbmhuZnlyaHRwY2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2OTc0MzAsImV4cCI6MjA3NzI3MzQzMH0.tqVeukQ0uSf4d8G_IR_UE0OZq4aWpUW-velnx3mXzdQ';
  const client = createClient(supabaseUrl, supabaseKey);

 {<script>
   async function sendMessage() {
    const content = document.getElementById("msgInput").value.trim();
    if (!content) return;

    // Ask once for nickname, remember it in localStorage
    let nickname = localStorage.getItem("mbk_nickname");
    if (!nickname) {
      nickname = prompt("Enter your road name:", "Brother") || "Brother";
      localStorage.setItem("mbk_nickname", nickname);
    }

    await client.from("messages").insert({
      content,
      user_email: "none",
      nickname,
    });

    document.getElementById("msgInput").value = "";
    loadMessages();
  }

  async function loadMessages() {
    const { data } = await client
      .from("messages")
      .select("*")
      .order("created_at", { ascending: true });

    const list = document.getElementById("messages");
    list.innerHTML = (data || [])
      .map(
        (m) =>
          // NOTE: backticks â†“â†“â†“ around the template string
          ` <p><b style="color:#3CA832;">${m.nickname || "Brother"}:</b> ${m.content}</p> `
      )
      .join(""); // join to make one HTML string
  }
</script>



  loadMessages();
  client.channel('chat').on('postgres_changes', { event: '*', schema: 'public', table: 'messages' }, loadMessages).subscribe();
</script>
</body>
</html>
