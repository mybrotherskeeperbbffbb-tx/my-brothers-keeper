<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MBK Control Panel</title>
  <style>
    :root{
      --od:#00ff00; --bg:#000; --panel:#0c0c0c; --dim:#0a0a0a;
      --glow:0 0 20px var(--od), inset 0 0 20px var(--od);
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--od);
      font-family:"Courier New", monospace;
    }
    nav{
      position:sticky; top:0; z-index:10;
      background:rgba(0,0,0,.9); padding:10px; text-align:center;
      box-shadow:0 0 10px var(--od);
    }
    nav a{
      color:var(--od); text-decoration:none; margin:0 15px; font-weight:bold;
    }
    nav a:hover{ color:#fff; text-shadow:0 0 10px var(--od) }
    .wrap{max-width:860px; margin:30px auto; padding:20px}
    .card{
      background:linear-gradient(180deg,#050505,#0f0f0f);
      border:1px solid #093; padding:18px; margin:20px 0;
      border-radius:14px; box-shadow:var(--glow);
    }
    h1,h2{ text-align:center; text-shadow:0 0 18px var(--od) }
    .btn{
      background:transparent; color:var(--od); border:1px solid var(--od);
      padding:10px 16px; border-radius:10px; cursor:pointer;
      font-weight:700; box-shadow:0 0 10px var(--od);
    }
    .btn:hover{ background:#002b00 }
    input[type="file"]{ width:100%; }
    .preview{
      display:block; width:100%; max-height:520px; object-fit:contain;
      margin-top:16px; background:#000; border-radius:10px; border:1px solid #063;
      box-shadow:0 0 14px #063;
    }
    textarea{
      width:100%; min-height:120px; background:#020; color:#fff;
      border:1px solid #083; border-radius:10px; padding:12px; resize:vertical;
      box-shadow:inset 0 0 10px #062;
    }
    .msg{ margin-top:10px; font-size:.95rem }
    .ok{ color:#9f9 }
    .err{ color:#f99 }
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .row .btn{flex:0 0 auto}
    footer{ text-align:center; color:var(--od); padding:35px 10px; opacity:.8 }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="brotherhood.html">Brotherhood</a>
    <a href="gallery.html">Gallery</a>
    <a href="about.html">About Us</a>
    <a href="chat.html">Chat</a>
    <a href="maintenance.html">Maintenance</a>
  </nav>

  <div class="wrap">

    <h1>üíö MBK Control Panel üíö</h1>

    <!-- PHOTO UPLOAD -->
    <section class="card">
      <h2>üì∏ Upload Photo</h2>
      <input id="file" type="file" accept="image/*" />
      <div class="row">
        <button class="btn" id="uploadBtn">Upload to Gallery</button>
        <span id="upMsg" class="msg"></span>
      </div>
      <img id="preview" class="preview" alt="" hidden />
    </section>

    <!-- STATUS POST -->
    <section class="card">
      <h2>üìù Post Status</h2>
      <textarea id="statusBox" placeholder="What‚Äôs new..."></textarea>
      <div class="row">
        <button class="btn" id="postBtn">Post</button>
        <span id="postMsg" class="msg"></span>
      </div>
    </section>

  </div>

  <footer>¬© 2025 MBK | BFFB</footer>

  <!-- Supabase + Config -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>

  <script>
    // ==== SAFETY CHECK ====
    if (!window.MBK_SUPABASE_URL || !window.MBK_SUPABASE_ANON){
      alert("Set MBK_SUPABASE_URL and MBK_SUPABASE_ANON inside config.js");
    }

    const supabase = window.supabase.createClient(
      window.MBK_SUPABASE_URL,
      window.MBK_SUPABASE_ANON
    );
    const BUCKET = window.MBK_BUCKET || "gallery";

    // ---- Image preview
    const fileInput = document.getElementById('file');
    const preview   = document.getElementById('preview');
    fileInput.addEventListener('change', () => {
      const f = fileInput.files?.[0];
      if (!f) { preview.hidden = true; return; }
      const url = URL.createObjectURL(f);
      preview.src = url; preview.hidden = false;
    });

    // ---- Upload handler
    document.getElementById('uploadBtn').addEventListener('click', async () => {
      const msg = document.getElementById('upMsg');
      msg.className = "msg"; msg.textContent = "";

      const file = fileInput.files?.[0];
      if (!file){ msg.textContent = "Pick a file first"; msg.classList.add("err"); return; }

      const path = `${Date.now()}-${file.name.replace(/\s+/g,'_')}`;

      msg.textContent = "Uploading...";
      const { data, error } = await supabase
        .storage.from(BUCKET)
        .upload(path, file, { upsert:true, cacheControl:'3600' });

      if (error){ msg.textContent = "Upload failed: " + error.message; msg.classList.add("err"); return; }

      const { data:pub } = supabase.storage.from(BUCKET).getPublicUrl(path);
      msg.innerHTML = `‚úÖ Uploaded. <a style="color:#9f9" href="${pub.publicUrl}" target="_blank">View</a> ‚Ä¢ <a style="color:#9f9" href="gallery.html">Open Gallery</a>`;
      msg.classList.add("ok");
    });

    // ---- Status post
    document.getElementById('postBtn').addEventListener('click', async () => {
      const box = document.getElementById('statusBox');
      const msg = document.getElementById('postMsg');
      msg.className = "msg"; msg.textContent = "";

      const text = box.value.trim();
      if (!text){ msg.textContent = "Write something first"; msg.classList.add("err"); return; }

      const { error } = await supabase.from('statuses').insert({ content: text });
      if (error){ msg.textContent = "Post failed: " + error.message; msg.classList.add("err"); return; }

      msg.textContent = "‚úÖ Posted. Check Gallery for latest updates.";
      msg.classList.add("ok");
      box.value = "";
    });
  </script>
</body>
</html>
